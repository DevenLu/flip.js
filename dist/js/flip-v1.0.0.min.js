/*!
 * flip 1.0.0 - Copyright 2015 Terrill Dent, http://terrill.ca
 * Released under MIT license, http://terrill.ca/flipjs/license
 */
var flip=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,flip={},w=[],x=navigator.userAgent,y=/webkit/i.test(navigator.appVersion),z=/firefox/i.test(x),A=/trident/i.test(x),B=/safari/i.test(x),C=window.opera,D=y?"webkit":z?"":A?"ms":C?"O":"",E=D+"transition",F=(D?D+"T":"t")+"ransform",G=(B?"-webkit-":"")+"transform",H=B?"webkitTransitionEnd":"transitionend",I=z?"px":"",J=[];return flip.simulateTouch=!window.hasOwnProperty("ontouchstart"),b=function(){var a,b=n.startXY.x-n.curXY.x;return k?(a=180*b/Math.min(m/2,.9*n.startXY.x),a=r?Math.max(0,Math.min(180,a)):Math.min(60,Math.pow(a,.8))):(a=180*b/Math.min(m/2,.9*(m-n.startXY.x)),a=p?180-Math.abs(Math.min(0,Math.max(-180,a))):Math.max(120,180-Math.pow(Math.abs(a),.8))),a},a=function(){m=window.innerWidth},c=function(){flip.transitioning=!1,flip.autotransition=!1,j.style.display="none",h.style.display="none",setTimeout(function(){flip.fire("globalTransitionEnd")},0)},d=function(){c(),u&&u.removeEventListener(H,d,!1),v&&v.removeEventListener(H,d,!1),k?(r&&(r.html.style.display="none"),flip.removeClass(q.html,"left")):(p&&(p.html.style.display="none"),flip.removeClass(q.html,"right")),setTimeout(function(){q.onStay()},0)},e=function(){r&&flip.removeClass(r.html,"right"),c(),q.html.style.display="none",J.push(q),u&&u.removeEventListener(H,e,!1),p&&(flip.remove(p.html),flip.remove(p.flip)),p=q,q=r,r=null,"block"!==q.html.style.display&&(q.html.style.display="block"),q.onShowComplete(J.length)},f=function(){p&&flip.removeClass(p.html,"left"),c(),q.html.style.display="none",J.pop(),v&&v.removeEventListener(H,f,!1),r&&(flip.remove(r.html),flip.remove(r.flip)),r=q,q=p,p=null,J.length>0&&(p=J[J.length-1]||null,p.html.style.display="none",g.appendChild(p.html),p.flip.style.display="none",h.appendChild(p.flip)),q.onShowComplete(J.length)},o={breach:function(a){flip.transitioning=!0,l=null,flip.autotransition||(flip.addClass(h,"dragging"),u&&(u.style[E]=G+" 0",u.removeEventListener(H,d,!1),u.removeEventListener(H,e,!1)),v&&(v.style[E]=G+" 0",v.removeEventListener(H,d,!1),v.removeEventListener(H,f,!1))),a>0?(k=!0,s=q.html,v=q.flip,t=r?r.html:null,u=r?r.flip:null):(k=!1,t=q.html,u=q.flip,s=p?p.html:null,v=p?p.flip:null),q.onObscure(),k&&p?p.html.style.display="none":r&&(r.html.style.display="none"),t&&(flip.addClass(t,"right"),flip.removeClass(t,"left"),t.style.display="block"),s&&(flip.addClass(s,"left"),flip.removeClass(s,"right"),s.style.display="block"),v&&(flip.addClass(v,"right"),flip.removeClass(v,"left"),v.style.display="block"),u&&(flip.addClass(u,"left"),flip.removeClass(u,"right"),u.style.display="block"),j.style.display="block",j.style.opacity=0,h.style.display="block"},reset:function(){if(u||v){var a,c,g=b();l=null,flip.removeClass(h,"dragging"),k?(a=e,c=d):(a=d,c=f),0===g?c():g>=180?a():90>g&&v?(v.style[F]="translateX( 0 ) perspective( 3000"+I+") rotateY( -0deg )",v.style[E]=G+" "+500*g/90+"ms ease-in",v.addEventListener(H,c,!1)):u&&(u.style[F]="translateX( 0 ) perspective( 3000"+I+") rotateY( -360deg )",u.style[E]=G+" "+500*(180-g)/90+"ms ease-in",u.addEventListener(H,a,!1))}},move:function(){if(u||v){var a=b();90>a?((!l||l>=90)&&u&&(u.style[F]="translateX( 4000px )"),v.style[F]="translateX( 0 ) perspective( 3000"+I+") rotateY( -"+a+"deg )"):a>=90&&((!l||90>l)&&v&&(v.style[F]="translateX( 4000px )"),u.style[F]="translateX( 0 ) perspective( 3000"+I+") rotateY( -"+(180+a)+"deg )"),l=a}}},flip.remove=function(a){a.parentNode&&a.parentNode.removeChild(a)},flip.forEach=function(a,b){var c,d=a.length;for(c=0;d>c;c++)b(a[c])},flip.hasClass=function(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))},flip.addClass=function(a,b){flip.hasClass(a,b)||(a.className+=" "+b)},flip.removeClass=function(a,b){if(flip.hasClass(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}},flip.addListener=function(a){w.push(a)},flip.removeListener=function(a){var b=w.indexOf(a);b>=0&&w.splice(w.indexOf(a),1)},flip.fire=function(a,b){flip.forEach(w,function(c){c&&c[a]&&c[a](b)})},flip.close=function(){q!==i&&(J.length>1&&(p&&(flip.remove(p.flip),flip.remove(p.html)),J.splice(0,J.length-1),p=i,p.html.style.display="",g.insertBefore(p.html,q.html),h.insertBefore(p.flip,q.flip),q.refreshFlip()),flip.pop())},flip.pop=function(){var a;q!==i&&setTimeout(function(){var b="translateX(0px) perspective(3000"+I+") ";flip.autotransition=!0,o.breach(-20,0),v.style[F]=b+"rotateY( -90deg )",u.style[F]=b+"rotateY( -360deg )",v.style[E]=G+" 300ms ease-in",u.style[E]=G+" 300ms ease-in",setTimeout(function(){a=function(){u.removeEventListener(H,a,!1),v.style[F]=b+"rotateY( 0deg )",setTimeout(f,400)},u.addEventListener(H,a,!1),u.style[F]=b+"rotateY( -270deg )"},10)},0)},flip.push=function(a){var b;i?(flip.autotransition=!0,flip.prime(a),setTimeout(function(){var a="translateX( 0 ) perspective(3000"+I+") ";o.breach(20,0),v.style[F]=a+"rotateY( 0deg )",u.style[F]=a+"rotateY( 90deg )",v.style[E]=G+" 300ms ease-in",u.style[E]=G+" 300ms ease-in",setTimeout(function(){b=function(){v.removeEventListener(H,b,!1),u.style[F]=a+"rotateY( 0deg )",setTimeout(e,400)},v.addEventListener(H,b,!1),v.style[F]=a+"rotateY( -90deg )"},10)},0)):(q=a,i=q,g.appendChild(q.html),h.appendChild(q.flip),q.onShowComplete(J.length))},flip.getStackHeight=function(){return J.length},flip.prime=function(a){r&&r!==a&&(flip.remove(r.html),flip.remove(r.flip)),r=a,r.html.style.display="none",g.appendChild(r.html),r.flip.style.display="none",h.appendChild(r.flip)},flip.createElem=function(a,b){var c,d=document.createElement(a);for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);return d},flip.init=function(b,c){var d=document.createDocumentFragment();g=flip.createElem("div",{className:"flip-base-pages"}),h=flip.createElem("div",{className:"flip-pages"}),j=flip.createElem("div",{className:"flip-shadow"}),d.appendChild(g),d.appendChild(j),d.appendChild(h),b.appendChild(d),c&&flip.push(c),n=flip.draggable.create(g,o,10),window.addEventListener("resize",a,!1),a()},flip}(),flip=window.flip;flip.basic=function(a){if(a="string"==typeof a?document.getElementById(a):a,1!==a.childNodes.length&&console.err)return void console.err("Expects a single child that contains all the page elements");var b,c,d,e=[];for(c=a.firstElementChild,d=function(a){e[a+1]&&flip.prime(e[a+1])},c.parentNode.removeChild(c);c.firstElementChild;)b=c.firstElementChild,b.parentNode.removeChild(b),e.push(flip.page.create(b,{onShowComplete:d}));flip.init(a,e[0])};var flip=window.flip;flip.draggable=function(){var a={getPagePosition:function(a){return a=a.touches?a.touches[0]:a,{x:a.pageX,y:a.pageY}},handleEvent:function(a){var b=this;switch(a.type){case"touchstart":case"mousedown":b.handleTouchStart(a);break;case"touchmove":case"mousemove":b.handleTouchMove(a);break;case"touchend":case"mouseup":b.handleTouchEnd(a);break;case"mouseout":a.relatedTarget&&"HTML"===a.relatedTarget.tagName&&b.handleTouchEnd(a)}},reset:function(){var a=this;document.body.removeEventListener("touchmove",a,!1),document.body.removeEventListener("touchend",a,!1),flip.simulateTouch&&(document.body.removeEventListener("mousemove",a,!1),document.body.removeEventListener("mouseup",a,!1),window.removeEventListener("mouseout",a,!1)),a.curXY&&(a.listener.reset&&a.listener.reset(),a.curXY=null)},handleTouchStart:function(a){var b=this;return a.preventDefault(),b.curXY&&a.touches&&a.touches.length>1?void b.reset():void((a.touches&&a.touches.length)>1||a.which&&3===a.which||a.button&&2===a.button||(b.outsideBuffer=!1,b.curXY=null,document.body.addEventListener("touchmove",b,!1),document.body.addEventListener("touchend",b,!1),flip.simulateTouch&&(document.body.addEventListener("mousemove",b,!1),document.body.addEventListener("mouseup",b,!1),window.addEventListener("mouseout",b,!1)),b.startXY=b.getPagePosition(a),b.curXY=b.startXY,b.listener.start&&b.listener.start()))},handleTouchMove:function(a){var b,c,d=this;return a.preventDefault(),a.touches&&a.touches.length>1?void d.reset():(d.curXY=d.getPagePosition(a),c=d.startXY.x-d.curXY.x,b=d.startXY.y-d.curXY.y,d.buffer&&!d.outsideBuffer&&Math.abs(c)>=d.buffer&&(d.listener.breach&&d.listener.breach(c,b),d.outsideBuffer=!0),void((!d.buffer||d.outsideBuffer)&&d.listener.move&&d.listener.move()))},handleTouchEnd:function(a){var b=this;a.preventDefault(),b.reset()}};return{create:function(b,c,d){var e=Object.create(a);return e.target=b,e.listener=c,e.buffer=d,b.addEventListener("touchstart",e,!1),flip.simulateTouch&&b.addEventListener("mousedown",e,!1),e}}}();var flip=window.flip;flip.page=function(){var a={refreshFlip:function(){var a,b=this,c=b.flip;return flip.transitioning?void(b.dirty||(b.dirty=!0,flip.addListener(b))):(b.dirty&&(b.dirty=!1,flip.removeListener(b)),b.flip=b.html.cloneNode(!0),void(c&&c.parentNode&&(a=c.parentNode,a&&(a.removeChild(c),a.appendChild(b.flip)))))},globalTransitionEnd:function(){this.refreshFlip()},onObscure:function(){var a=this;a.listener.onObscure&&a.listener.onObscure()},onStay:function(){var a=this;a.listener.onStay&&a.listener.onStay()},onShowComplete:function(a){var b=this;b.listener.onShowComplete&&b.listener.onShowComplete(a),b.onStay()}};return{create:function(b,c){var d=Object.create(a);return flip.addClass(b,"flip-page"),d.listener=c,d.html=flip.createElem("div",{className:"flip-page-wrapper"}),d.html.appendChild(b),d.flip=d.html.cloneNode(!0),d}}}();